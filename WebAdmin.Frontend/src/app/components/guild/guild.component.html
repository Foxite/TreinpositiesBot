<div *ngIf="guild != null" class="guildHeader">
  <span class="icon"><img src="{{guild.iconUrl}}" alt="{{guild.name}} icon" /></span>
  <h1 class="nameContainer">
    <span class="name">{{guild.name}} <span class="id muted">({{guild.id}})</span></span>
  </h1>
</div>
<div [ngSwitch]="displayState">
  <div *ngSwitchCase="DisplayState.NoGuildSelected">Please select a server to the left.</div>
  <div *ngSwitchCase="DisplayState.LoadingGuild">Loading channel configuration...</div>
  <div *ngSwitchCase="DisplayState.BotNotInGuild">The bot is not in this server and cannot access the channel list.</div>
  <div *ngSwitchCase="DisplayState.ErrorLoadingGuild">An unknown error has occurred while loading the channel configuration.</div>
  <div *ngSwitchCase="DisplayState.GuildSelected" class="guildConfig">
    <div class="channelSelect">
      <ol class="categories">
        <!-- TODO list item for default guild settings -->
        <li [routerLink]="['/guilds/', guildConfig!.id, '0']">
          <span class="name">Server-wide default</span>
        </li>
        <li *ngFor="let category of guildConfig!.categories">
          <details open><summary><h4 class="name">{{category.name || "Uncategorized" }}</h4></summary>
            <ol class="boxlist">
              <!-- TODO selectable -->
              <li *ngFor="let channel of category.channels" [routerLink]="['/guilds/', guildConfig!.id, channel.id]">
                <span class="name">{{channel.name}}</span>
              </li>
            </ol>
          </details>
        </li>
      </ol>
    </div>

    <div class="configForm">
      <div class="selectedItemTitle">
        {{this.itemDisplayName}}
      </div>
      <div *ngIf="itemConfig" [formGroup]="itemConfigForm" (input)="onFormInput()">
        <!--{{JSON.stringify(itemConfig)}}-->
        <form>
          <table>
            <tbody>
            <tr>
                <td>Cooldown:</td>
                <td><input type="checkbox" formControlName="specifyCooldown" [attr.checked]="itemConfig.cooldownSeconds != null ? 'checked' : null"></td>
                <td><input type="number" formControlName="cooldown" value="{{itemConfig.cooldownSeconds}}"> seconds</td>
            </tr>
            <tr>
                <td>Sources:</td>
                <td><input type="checkbox" formControlName="specifySources" [attr.checked]="itemConfig.sourceNames != null ? 'checked' : null"></td>
                <td>
                  <select multiple="multiple" formControlName="sources">
                    <option *ngFor="let sourceName of this.availableSourceNames" value="{{sourceName}}" [attr.selected]="(itemConfig.sourceNames || guildConfig!.sourceNames || this.availableSourceNames).includes(sourceName)">{{sourceName}}</option>
                  </select>
                </td>
            </tr>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </div>
</div>
